Logger.info "=========== Writing <%= @ticket_count %> tickets for #{listing.id} ==========="
order = SeedHelpers.create_order(
  %{
    user_id: user.id, 
    credit_card_id: card.id,
    slug: Random.generate_slug(),
    status: "completed", 
    subtotal: 5000,
    credit_card_fee: 500,
    processing_fee: 500,
    total_price: 6000,
    completed_at: NaiveDateTime.utc_now()
  }
)

ticket_name = "Ticket for <%= String.replace(@title, "\"", "'") %>"

Enum.map(1..<%= @ticket_count %>, fn(x) ->
  price =  <%= round(@price) * 100 %> 

  Logger.info "=========== Inserted ticket ##{x} for #{listing.id} ==========="

  case TicketAgent.Random.sample([true, true, false, true, false, true, true]) do
    true ->
      status = TicketAgent.Random.sample(["purchased", "emailed"])
      Logger.info "Inserting #{status} ticket"
      SeedHelpers.create_ticket(listing, order, status, price)
    false ->
      Logger.info "Inserting available ticket"
      SeedHelpers.create_ticket(listing, order, "available", price)
  end
  |> TicketAgent.Repo.insert!
  
end)
Logger.info "=========== Inserted 80 tickets for #{listing.id} ==========="
